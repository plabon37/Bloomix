<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>AI Speaker Product Adder</title>
  <link rel="stylesheet" href="styles1.css" />
</head>
<body>
  <div class="container">
    <!-- Navbar -->
    <nav class="navbar navbar-expand-lg bg-body-tertiary" data-bs-theme="light">
      <div class="container-fluid">
        <!-- Logo -->
        <a class="navbar-brand d-flex align-items-center" href="#">
          <img src="picture/logo.jpg" alt="Bloomix logo" width="40" height="40" class="d-inline-block align-text-top">
        </a>

        <!-- Toggle button for mobile -->
        <button class="navbar-toggler" type="button"
                data-bs-toggle="collapse" data-bs-target="#navbarNavDropdown"
                aria-controls="navbarNavDropdown" aria-expanded="false" aria-label="Toggle navigation">
          <span class="navbar-toggler-icon"></span>
        </button>

        <!-- Navbar content -->
        <div class="collapse navbar-collapse" id="navbarNavDropdown">
          <ul class="navbar-nav me-auto mb-2 mb-lg-0">
            <li class="nav-item">
              <a class="nav-link active" aria-current="page" href="index.html">Home</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="speaker.html">Speaker</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="#">Headphone</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="#">PowerBank</a>
            </li>
          </ul>

          <!-- Search form -->
          <form class="d-flex" role="search">
            <input class="form-control me-2" type="search" placeholder="Search" aria-label="Search">
            <button class="btn btn-outline-success" type="submit">Search</button>
          </form>
        </div>
      </div>
    </nav>

    <header>
      <h1>ðŸ”Š Speaker Catalog â€” AI Add</h1>
      <p>Describe a speaker in plain English and let the page add it as a product card.</p>
    </header>

    <main class="wrap">
      <!-- Catalog -->
      <section class="panel catalog" aria-labelledby="catalog-title">
        <div class="catalog-head">
          <h2 id="catalog-title" class="sr-only">Product Catalog</h2>
          <div class="badge">Products</div>
          <input class="search" id="search" type="text" placeholder="Search by brand, name, featureâ€¦" />
        </div>
        <div id="grid" class="grid" aria-live="polite"></div>
        <div id="empty" class="empty" hidden>Nothing here yet. Add your first speaker with the AI form â†’</div>
      </section>

      <!-- AI Add Panel -->
      <aside class="panel ai-panel" aria-labelledby="ai-title">
        <div class="ai-head">
          <div class="badge">AI Add</div>
          <h2 id="ai-title" class="sr-only">AI Product Adder</h2>
        </div>

        <label for="prompt" class="sr-only">Describe the speaker</label>
        <textarea id="prompt" rows="8" placeholder="e.g. Add JBL Flip 6 portable Bluetooth speaker for $99, IP67 waterproof, 12h battery, stereo pairing, image https://picsum.photos/seed/jbl/800/500"></textarea>
        <p class="hint">Tip: include <strong>name</strong>, <strong>brand</strong>, <strong>price</strong>, <strong>key features</strong>, and an <strong>image URL</strong>. File upload supported below.</p>

        <div class="row mt-10">
          <div>
            <label class="hint" for="imgUrl">Image URL (optional)</label>
            <input id="imgUrl" type="url" placeholder="https://example.com/speaker.jpg" />
          </div>
          <div>
            <label class="hint" for="imgFile">Or upload image</label>
            <input id="imgFile" type="file" accept="image/*" />
          </div>
        </div>

        <div class="btns">
          <button class="primary" id="addBtn">Let AI Add â–¶</button>
          <button class="ghost" id="exampleBtn">Try an example</button>
          <button class="danger" id="clearBtn" title="Clear saved products">Clear All</button>
        </div>

        <div class="examples">
          <span class="chip" data-eg="Add Sony SRS-XE200 for $129, X-Balanced driver, IP67 dust & water proof, 16h battery, fast charging, Bluetooth 5.2, image https://picsum.photos/seed/sony/800/500">Sony compact, IP67</span>
          <span class="chip" data-eg="Add Bose SoundLink Flex at $149, rugged outdoor design, PositionIQ, waterproof & floats, 12 hours battery, USB-C, image https://picsum.photos/seed/bose/800/500">Bose outdoor</span>
          <span class="chip" data-eg="Add JBL PartyBox Encore for $299, 100W sound, karaoke mic included, RGB lights, splash proof IPX4, Bluetooth 5.1, image https://picsum.photos/seed/jbl2/800/500">Party speaker</span>
        </div>

        <p class="hint">All data stays in your browser (localStorage). No server required.</p>
      </aside>
    </main>

    <template id="cardTpl">
      <article class="card" data-id="">
        <div class="imgwrap"><img alt="Product image" loading="lazy" /></div>
        <div class="content">
          <div class="title"></div>
          <div class="meta"></div>
          <ul class="feature-list"></ul>
        </div>
        <div class="card-actions">
          <div class="price"></div>
          <div>
            <button class="ghost edit">Edit</button>
            <button class="ghost del">Delete</button>
          </div>
        </div>
      </article>
    </template>

    <dialog id="editDlg">
      <form method="dialog" id="editForm" class="panel edit-form">
        <h3 class="modal-title">Edit Product</h3>

        <div class="row">
          <div>
            <label class="hint" for="e_name">Name</label>
            <input id="e_name" type="text" required />
          </div>
          <div>
            <label class="hint" for="e_brand">Brand</label>
            <input id="e_brand" type="text" required />
          </div>
        </div>

        <div class="row mt-10">
          <div>
            <label class="hint" for="e_price">Price (USD)</label>
            <input id="e_price" type="number" min="0" step="0.01" />
          </div>
          <div>
            <label class="hint" for="e_img">Image URL</label>
            <input id="e_img" type="url" />
          </div>
        </div>

        <label class="hint block mt-10" for="e_features">Features (comma or newline separated)</label>
        <textarea id="e_features" rows="4"></textarea>

        <div class="btns justify-end mt-12">
          <button class="ghost" value="cancel">Cancel</button>
          <button class="primary" id="saveEdit" value="default">Save</button>
        </div>
      </form>
    </dialog>
  </div>

  <script>
    /* ------------------------------ Utilities ------------------------------ */
    const $ = (sel, root = document) => root.querySelector(sel);
    const $$ = (sel, root = document) => Array.from(root.querySelectorAll(sel));

    function uid() { return Math.random().toString(36).slice(2, 10); }

    function money(n) {
      if (n === undefined || n === null || n === '' || isNaN(Number(n))) return 'â€”';
      try { return new Intl.NumberFormat(undefined, { style: 'currency', currency: 'USD' }).format(Number(n)); }
      catch { return `$${Number(n).toFixed(2)}`; }
    }

    function placeholderFor(name = "Speaker") {
      const seed = encodeURIComponent((name||'speaker').toLowerCase());
      return `https://picsum.photos/seed/${seed}/800/500`;
    }

    /* ------------------------------ Storage ------------------------------ */
    const STORE_KEY = 'ai-speaker-catalog-v1';
    const store = {
      load() { try { return JSON.parse(localStorage.getItem(STORE_KEY) || '[]'); } catch { return []; } },
      save(items) { localStorage.setItem(STORE_KEY, JSON.stringify(items)); },
      clear() { localStorage.removeItem(STORE_KEY); }
    };

    /* --------------------------- AI-ish Parser ---------------------------- */
    function parsePrompt(prompt) {
      const out = { id: uid(), brand: '', name: '', price: null, img: '', features: [] };
      if (!prompt) return out;

      // Price like $199 or 199 USD
      const priceMatch = prompt.match(/\$(\d+(?:\.\d{1,2})?)|\b(\d+(?:\.\d{1,2})?)\s?(USD|usd|\$)\b/);
      if (priceMatch) out.price = Number(priceMatch[1] || priceMatch[2]);

      // Image URL
      const urlMatch = prompt.match(/https?:[^\s]+\.(?:png|jpe?g|webp|gif)/i);
      if (urlMatch) out.img = urlMatch[0];

      // Brand + Name heuristics
      const addIdx = prompt.toLowerCase().indexOf('add ');
      let nameChunk = addIdx >= 0 ? prompt.slice(addIdx + 4) : prompt;
      nameChunk = nameChunk.replace(/for\s*\$?.*$/i, '')
                           .replace(/at\s*\$?.*$/i, '')
                           .replace(/,\s*image\s+.*/i, '')
                           .replace(/,\s*(features|specs)\s*:.*/i, '');
      const words = nameChunk.trim().split(/\s+/).slice(0, 6).join(' ');
      const caps = words.match(/[A-Z][A-Za-z0-9\-+]+/g) || [];
      const tokens = (caps.length ? caps : words.split(/\s+/)).filter(Boolean);
      if (tokens.length) {
        out.brand = tokens[0];
        out.name = tokens.slice(1).join(' ') || out.brand;
      }

      // Features
      const afterFirstComma = prompt.split(',').slice(1).join(',');
      const featureBits = afterFirstComma
        .replace(/image\s+https?:[^\s,]+/ig, '')
        .split(/,|\band\b|\+|\//i)
        .map(s => s.trim())
        .filter(s => s && !/\$\d/.test(s));

      const norm = s => s
        .replace(/ipx?(\d)/i, 'IP$1')
        .replace(/\b(bt|bluetooth)\s*([0-9]\.?[0-9]?)/i, 'Bluetooth $2')
        .replace(/(hours?|hrs?)\b/i, 'h')
        .replace(/battery\s*life?/i, 'battery');

      out.features = [...new Set(featureBits.map(norm))].slice(0, 8);

      if (!out.img) out.img = placeholderFor(out.name || out.brand || 'speaker');
      return out;
    }

    /* ------------------------------ Rendering ---------------------------- */
    const grid = $('#grid');
    const empty = $('#empty');
    const tpl = $('#cardTpl');
    let items = store.load();

    function render() {
      grid.innerHTML = '';
      const q = ($('#search').value || '').toLowerCase();
      const filtered = items.filter(x => !q || [x.brand, x.name, ...(x.features||[])].join(' ').toLowerCase().includes(q));

      if (!filtered.length) { empty.hidden = false; return; }
      empty.hidden = true;

      for (const it of filtered) {
        const node = tpl.content.cloneNode(true);
        const card = node.querySelector('.card');
        card.dataset.id = it.id;
        card.querySelector('img').src = it.img || placeholderFor(it.name);
        card.querySelector('img').alt = `${it.brand ? it.brand + ' ' : ''}${it.name || 'Speaker'}`;
        card.querySelector('.title').textContent = `${it.brand || ''} ${it.name || ''}`.trim() || 'Untitled Speaker';
        card.querySelector('.meta').textContent = it.brand ? `Brand â€¢ ${it.brand}` : 'â€”';
        const fl = card.querySelector('.feature-list');
        fl.innerHTML = '';
        (it.features || []).forEach(f => { const li = document.createElement('li'); li.textContent = f; fl.appendChild(li); });
        card.querySelector('.price').textContent = money(it.price);

        // actions
        card.querySelector('.del').addEventListener('click', () => removeItem(it.id));
        card.querySelector('.edit').addEventListener('click', () => openEdit(it.id));

        grid.appendChild(node);
      }
    }

    function addItem(data) { items.unshift(data); store.save(items); render(); }
    function removeItem(id) { items = items.filter(x => x.id !== id); store.save(items); render(); }

    /* ------------------------------ Edit Modal --------------------------- */
    const dlg = $('#editDlg');
    const eName = $('#e_name');
    const eBrand = $('#e_brand');
    const ePrice = $('#e_price');
    const eImg = $('#e_img');
    const eFeatures = $('#e_features');

    function openEdit(id) {
      const it = items.find(x => x.id === id);
      if (!it) return;
      dlg.setAttribute('data-id', id);
      eName.value = it.name || '';
      eBrand.value = it.brand || '';
      ePrice.value = it.price ?? '';
      eImg.value = it.img || '';
      eFeatures.value = (it.features || []).join('\n');
      dlg.showModal();
    }

    $('#saveEdit').addEventListener('click', (ev) => {
      ev.preventDefault();
      const id = dlg.getAttribute('data-id');
      const idx = items.findIndex(x => x.id === id);
      if (idx < 0) return dlg.close();
      items[idx] = {
        ...items[idx],
        name: eName.value.trim(),
        brand: eBrand.value.trim(),
        price: ePrice.value ? Number(ePrice.value) : null,
        img: eImg.value.trim() || placeholderFor(eName.value || eBrand.value),
        features: eFeatures.value.split(/\n|,/).map(s=>s.trim()).filter(Boolean).slice(0, 12)
      };
      store.save(items);
      dlg.close();
      render();
    });

    dlg.addEventListener('click', (e) => { if (e.target === dlg) dlg.close(); });

    /* ------------------------------ AI Add Flow -------------------------- */
    $('#addBtn').addEventListener('click', async () => {
      const prompt = $('#prompt').value.trim();
      let data = parsePrompt(prompt);

      // Optional image overrides
      const url = $('#imgUrl').value.trim();
      if (url) data.img = url;

      const file = $('#imgFile').files && $('#imgFile').files[0];
      if (file) {
        // Convert to data URL for local preview
        data.img = await new Promise((resolve) => {
          const r = new FileReader();
          r.onload = () => resolve(r.result);
          r.readAsDataURL(file);
        });
      }

      if (!data.brand && !data.name) {
        alert('Please include at least a brand or a name in your description.');
        return;
      }

      addItem(data);
      // Clear minimal fields but keep prompt so users can tweak
      $('#imgUrl').value = '';
      $('#imgFile').value = '';
    });

    $('#exampleBtn').addEventListener('click', () => {
      $('#prompt').value = 'Add Anker Soundcore Motion+ for $99, Hi-Res audio, Qualcomm aptX, 30W, IPX7 waterproof, 12h battery, USB-C fast charge, image https://picsum.photos/seed/anker/800/500';
    });

    $$('.chip').forEach(chip => chip.addEventListener('click', () => { $('#prompt').value = chip.dataset.eg; }));

    $('#clearBtn').addEventListener('click', () => {
      if (confirm('Clear all saved products? This cannot be undone.')) { store.clear(); items = []; render(); }
    });

    $('#search').addEventListener('input', render);

    // Seed demo if empty on first load
    if (!items.length) {
      items = [
        { id: uid(), brand: 'Sony', name: 'SRS-XB23', price: 99, img: placeholderFor('sony xb23'), features: ['Extra Bass', 'IP67', '12h battery', 'Bluetooth 5.0'] },
        { id: uid(), brand: 'JBL', name: 'Flip 6', price: 119, img: placeholderFor('jbl flip6'), features: ['IP67 waterproof', '12h battery', 'PartyBoost', 'USB-C'] },
      ];
      store.save(items);
    }

    render();
  </script>
</body>
</html>
<!-- Bootstrap JS Bundle -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js"></script>